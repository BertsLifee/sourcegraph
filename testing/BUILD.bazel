sh_test(
    name = "backend",
    srcs = [":backend.sh"],
    args = [
        "$(location //testing/tools:before_run_server_image)",  # helper script
        "$(location //testing/tools:run_server_image)",  # helper script
        "$(location //enterprise/cmd/server:image_tarball)",  # image we're testing against
        "$(location //dev/gqltest:gqltest_test)",  # actual test
        "$(location //dev/authtest:authtest_test)",  # actual test
    ],
    data = [
        "//dev/authtest:authtest_test",
        "//dev/gqltest:gqltest_test",
        "//enterprise/cmd/server:image_tarball",
        "//testing/tools:before_run_server_image",
        "//testing/tools:run_server_image",
    ],
    env_inherit = [
        "AWS_ACCESS_KEY_ID",
        "AWS_CODE_COMMIT_PASSWORD",
        "AWS_CODE_COMMIT_USERNAME",
        "AWS_SECRET_ACCESS_KEY",
        "AZURE_DEVOPS_TOKEN",
        "AZURE_DEVOPS_USERNAME",
        "BITBUCKET_SERVER_TOKEN",
        "BITBUCKET_SERVER_URL",
        "BITBUCKET_SERVER_USERNAME",
        "GHE_GITHUB_TOKEN",
        "PERFORCE_PASSWORD",
        "PERFORCE_PORT",
        "PERFORCE_USER",
        "SOURCEGRAPH_LICENSE_GENERATION_KEY",
    ],
    tags = ["requires-network"],
)
