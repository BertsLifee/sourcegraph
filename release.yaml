meta:
  productName: sourcegraph
  repository: "github.com/sourcegraph/sourcegraph"
  owners:
    - "@sourcegraph/search"
  artifacts:

requirements:
  - name: "Bazel"
    cmd: bazel version
    fixInstructions: Run `sg setup` and try again.
  - name: "buildozer"
    cmd: buildozer -version
    fixInstructions: Run `go install github.com/bazelbuild/buildtools/buildozer@latest` and try again.
  - name: "Github CLI"
    cmd: gh version
    fixInstructions: brew install gh

create:
  steps:
    patch:
      - name: "generate"
        cmd: |
          bazel run //dev:write_all_generated
      # we don't use this for patch releases
      # - name: "migration"
      #   cmd: |
      #     comby -in-place \
      #       'const maxVersionString = ":[1]"' \
      #       'const maxVersionString = "{{version}}"' \
      #       internal/database/migration/shared/data/cmd/generator/consts.go

      - name: "bazel"
        cmd: |
          bazel run //tools/release:create_patch --run_under="cd $PWD &&" -- {{version}}
